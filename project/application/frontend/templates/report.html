<!DOCTYPE html>
<html lang="en">

<head>
		

  {% include "comp/includecss.html" %}
  
  <!-- datatable -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.6.5/css/buttons.dataTables.min.css">
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
  
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/dataTables.buttons.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.flash.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.html5.min.js"></script>
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.5/js/buttons.print.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
</head>

<style>
  .form-control {
    font-size: 1rem !important;
    text-align: start !important;
  }
</style>

<body id="page-top">
  <div id="wrapper">
    {% include "comp/sidebar.html" %}
    <div id="content-wrapper" class="d-flex flex-column">
      <!-- Main Content -->
      <div id="content">
        {% include "comp/header.html" %}

        <div class="container-fluid">
          <div class="row">
            <div class="card">
              <div class="mx-0 my-3">
                <form action="/report" method="GET" enctype="multipart/form-data">
                  <div class="input-group flex-nowrap">
                    <span class="input-group-text"><i class="fa fa-search"></i></span>
                    <input type="text" placeholder="ค้นหา" id="areatodisplay" class="form-control">
                    <select class="form-select" id="mySelect" name="reports">
                      <option disabled selected>รายงาน</option>
                      <option value="car">การเข้าออกของรถ</option>
                      <option value="salestax">รายงานภาษีขาย</option>
                      <option value="vat">รถค้าง</option>
                    </select>
                    <button class="btn btn-primary test"><i class="fas fa-stream"></i> แสดงผล</button>
                  </div>

                  <div class="row mt-2">
                    <div class="col-lg-2">
                      <label class="form-label mb-0">เริ่มวันที่</label>
                      <input type="date" class="form-control" id="date_start" name="date_start">
                    </div>
                    <div class="col-lg-2">
                      <label class="form-label mb-0">ถึงวันที่</label>
                      <input type="date" class="form-control" id="date_end" name="date_end">
                    </div>
                    <div class="col-lg-2">
                      <label class="form-label mb-0">ประเภทสมาชิก</label>
                      <select class="form-select" id="search">
                        <option selected>-- ค้นหาสมาชิก --</option>
                        <option value="1">Member</option>
                        <option value="2">VIP</option>
                        <option value="3">Vistor</option>
                      </select>
                    </div>
                    <div class="col-lg-6 mt-4">
                      <a href="#" class="m-2">Clear All</a>
                      <div id="exportbtn"></div>
                      <button type="button" class="btn btn-excel" id="export-excel"><i class="far fa-file-excel"></i> Export to Excel</button>
                      <button type="button" class="btn btn-danger" id="export-pdf"><i class="far fa-file-pdf"></i> Export to PDF</button>
                      <button type="button" class="btn btn-primary" id="export-print"><i class="fas fa-print"></i> Print</button>
                    </div>
                  </div>
                </form>

                <div id="areatodisplay"></div>
                <div>
                <table class="table table-bordered" id="monitorTable">
                  <thead>
                    <tr>
                      {% for x in table_header %}
                        <th>{{x}}</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tfoot>
                    <tr>
                      {% for x in table_header %}
                        <th>{{x}}</th>
                      {% endfor %}
                    </tr>
                  </tfoot>
                  <tbody>
                  </tbody>
                </table>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>


  <script type="text/javascript">
  pdfMake.fonts = {
   THSarabun: {
     normal: 'THSarabun.ttf',
     bold: 'THSarabun-Bold.ttf',
     italics: 'THSarabun-Italic.ttf',
     bolditalics: 'THSarabun-BoldItalic.ttf'
   }
  }
  var docDefinition = {
      content: 'ทดสอบ',
      defaultStyle:{
      font: 'THSarabun'
      }
  };
			//คำสั่ง Jquery เริ่มทำงาน เมื่อ โหลดหน้า Page เสร็จ 
			$(document).ready(function(){
        $.noConflict();
				//กำหนดให้  Plug-in dataTable ทำงาน ใน ตาราง Html ที่มี id เท่ากับ example
				var table = $('#monitorTable').DataTable({
          "dom": 'Bfrtip',
          "buttons": [
          'excel',
            { // กำหนดพิเศษเฉพาะปุ่ม pdf
                "extend": 'pdf', // ปุ่มสร้าง pdf ไฟล์
                "messageBottom": null,
                "text": 'PDF', // ข้อความที่แสดง
                "pageSize": 'A4',   // ขนาดหน้ากระดาษเป็น A4            
                "customize":function(doc){ // ส่วนกำหนดเพิ่มเติม ส่วนนี้จะใช้จัดการกับ pdfmake
                    // กำหนด style หลัก
                    doc.defaultStyle = {
                        font:'THSarabun',
                        fontSize:16                                 
                    };
                    // กำหนดความกว้างของ header แต่ละคอลัมน์หัวข้อ
                    doc.content[1].table.widths = [ 50, 'auto', '*', '*' ];
                    doc.styles.tableHeader.fontSize = 16; // กำหนดขนาด font ของ header
                    var rowCount = doc.content[1].table.body.length; // หาจำนวนแะวทั้งหมดในตาราง
                    // วนลูปเพื่อกำหนดค่าแต่ละคอลัมน์ เช่นการจัดตำแหน่ง
                    for (i = 1; i < rowCount; i++) { // i เริ่มที่ 1 เพราะ i แรกเป็นแถวของหัวข้อ
                        doc.content[1].table.body[i][0].alignment = 'center'; // คอลัมน์แรกเริ่มที่ 0
                        doc.content[1].table.body[i][1].alignment = 'center';
                        doc.content[1].table.body[i][2].alignment = 'left';
                        doc.content[1].table.body[i][3].alignment = 'right';
                    };                                  
                    console.log(doc); // เอาไว้ debug ดู doc object proptery เพื่ออ้างอิงเพิ่มเติม
                }
            }, // สิ้นสุดกำหนดพิเศษปุ่ม pdf
            'print'
          ],
					"processing": true,
					"ajax": {
            url: "{{api}}", // "{{api}}{{api_param}} /report/table-car/datatable?date_in=aaaa&date_out=aaa&type=aaa
						dataSrc: "data"
					}
				}
					
        );
        
        table.buttons().container().appendTo($('#exportbtn'));
        $('#exportbtn').hide();
        $("#export-excel").click(function(){
          $(".dt-button.buttons-excel").click();
        });

        $("#export-pdf").click(function(){
          $(".dt-button.buttons-pdf").click();
          pdfMake.createPdf(docDefinition).open();
        });

        $("#export-print").click(function(){
          $(".dt-button.buttons-print").click();
        });

			});

    function calldropdown(mySelect) {
      document.getElementById("areatodisplay").innerHTML = mySelect;
    }

    $("#sidebarToggle, #sidebarToggleTop").on('click', function (e) {
      $("body").toggleClass("sidebar-toggled");
      $(".sidebar").toggleClass("toggled");
      if ($(".sidebar").hasClass("toggled")) {
        $('.sidebar .collapse').collapse('hide');
      };
    });

    // Scroll to top button appear
    $(document).on('scroll', function () {
      var scrollDistance = $(this).scrollTop();
      if (scrollDistance > 100) {
        $('.scroll-to-top').fadeIn();
      } else {
        $('.scroll-to-top').fadeOut();
      }
    });

    // Smooth scrolling using jQuery easing
    $(document).on('click', 'a.scroll-to-top', function (e) {
      var $anchor = $(this);
      $('html, body').stop().animate({
        scrollTop: ($($anchor.attr('href')).offset().top)
      }, 1000, 'easeInOutExpo');
      e.preventDefault();
    });


  </script>
</body>

</html>